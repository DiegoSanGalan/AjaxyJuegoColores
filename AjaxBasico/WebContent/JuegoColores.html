<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<link rel=styleSheet href="./CSS/tablas.css" type="text/css" media=all>
<title>Colorines</title>

<script type="text/javascript">
	var contadorParejas = 0; // hasta 10 parejas
	var segundaVez = 0; // variable para controlar la segunda casilla que hace click
	var primeraCelda = null; //variable para almacenar la primera celda seleccionada

	function iniciaObjetoRequest() {

		return new XMLHttpRequest();
	}

	function rellenaCajaColores() {
		xmlHttp = iniciaObjetoRequest();
		xmlHttp.onreadystatechange = procesarEventosColores; // llama a procesarEventos cada vez que cambia el estado.
		xmlHttp.open('GET', 'GenerarColores', true); //indicamos como vamos a enviar los datos, en este caso con el metodo GET al archivo meses.php?num= el valor que le indiquemos en el textbox
		xmlHttp.send(null);

	}

	function procesarEventosColores() {
		//Obtenemos el control del TAG que contendrá la respuesta
		if (xmlHttp.readyState == 4) //ya hemos recibido respuesta del servidor
		{
			if (xmlHttp.status == 200)// y el código de la cabecera http es bueno
			{
				//alert("He recibido " + xmlHttp.responseText); //.responseText es el body de la respuesta expresado en texto plano
				//document.getElementById("cajatexto").value = xmlHttp.responseText;

				// en .response.XML ya directamente lo ha convertido en XML
				var lista_celdas = xmlHttp.responseXML
						.getElementsByTagName("celda");
				var nelementos = lista_celdas.length;
				var opcion; //sera de tipo Option almacenaremos cada elemento del select antes de añadirlo

				var id = null;
				var nombre = null;

				for ( var i = 0; i < nelementos; i++) {

					/*var id = lista_dptos[i].children[0].textContent;
					var nombre = lista_dptos[i].children[1].textContent;*///FORMA MÁS ELEGANTE Y LÓGICA, PERO NO COMPATIBLE CON IE :S
					var elementoCelda = lista_celdas[i]
							.getElementsByTagName("color")[0];

					var id = "num" + (i + 1); //para 
					var midiv = document.getElementById(id);

					color = elementoCelda.childNodes[0].data; //también podría usar firstChild
					midiv.style.backgroundColor = color;
					midiv.setAttribute("title", color);
					//var atributorecogido = midiv.getAttribute("value");

					//color = elementoCelda.childNodes[0].data; //también podría usar firstChild

					//num2.style.backgroundColor = color;
				}
			} else {
				alert("Ha ocurrido un error" + xmlHttp.status + ":"
						+ xmlHttp.statusText);
			}
		}

	}

	function seleccionar(elegido) {

		if (((contadorParejas < 10) && (segundaVez == 0)) && (elegido.style.backgroundColor != "white"))
		{
			//Para impedir que elija un blanco.
			
			opacidad = elegido.style.opacity;
			primeraCelda = elegido;
			segundaVez = 1;

			if (opacidad == 0.6) 
			{
				elegido.style.opacity = 1;
			}
			else 
			{
				elegido.style.opacity = 0.6;
			}

			

		}
		else 
		{
			elegido.style.opacity = 0.6;
			if ((elegido.style.backgroundColor != "white")&&(primeraCelda.style.backgroundColor == elegido.style.backgroundColor))
			   
				{
				alert ("acertaste ");
				
				// cambio el fondo de las dos celdas
				primeraCelda.style.backgroundColor = "white";
				elegido.style.backgroundColor = "white";
				segundaVez=0;
				contadorParejas++;
				}
			else
				{
				alert ("Que torpe eres");
				elegido.style.opacity = 1;
				primeraCelda.style.opacity = 1;
				primeraCelda = null;
				segundaVez=0;
				}
		}	

		if (contadorParejas == 10) 
		{
			alert("Hemos terminado");
			
		}
		
	}

	
</script>

</head>
<body>




	<div id="contenedor">
		<div id="contenidos">
			<div id="num1" class="celda" onclick="seleccionar(this)">1</div>
			<div id="num2" class="celda" onclick="seleccionar(this)">2</div>
			<div id="num3" class="celda" onclick="seleccionar(this)">3</div>
			<div id="num4" class="celda" onclick="seleccionar(this)">4</div>
			<div id="num5" class="celda" onclick="seleccionar(this)">5</div>
		</div>
		<div id="contenidos">
			<div id="num6" class="celda" onclick="seleccionar(this)">1</div>
			<div id="num7" class="celda" onclick="seleccionar(this)">2</div>
			<div id="num8" class="celda" onclick="seleccionar(this)">3</div>
			<div id="num9" class="celda" onclick="seleccionar(this)">4</div>
			<div id="num10" class="celda" onclick="seleccionar(this)">5</div>
		</div>
		<div id="contenidos">
			<div id="num11" class="celda" onclick="seleccionar(this)">1</div>
			<div id="num12" class="celda" onclick="seleccionar(this)">2</div>
			<div id="num13" class="celda" onclick="seleccionar(this)">3</div>
			<div id="num14" class="celda" onclick="seleccionar(this)">4</div>
			<div id="num15" class="celda" onclick="seleccionar(this)">5</div>
		</div>
		<div id="contenidos">
			<div id="num16" class="celda" onclick="seleccionar(this)">1</div>
			<div id="num17" class="celda" onclick="seleccionar(this)">2</div>
			<div id="num18" class="celda" onclick="seleccionar(this)">3</div>
			<div id="num19" class="celda" onclick="seleccionar(this)">4</div>
			<div id="num20" class="celda" onclick="seleccionar(this)">5</div>
		</div>

		<div>
			<input id="botonrellena" type="submit" value="Rellena" class="btn"
				onclick="rellenaCajaColores();">
		</div>
	</div>




</body>
</html>